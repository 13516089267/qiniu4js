{"version":3,"file":null,"sources":["../src/upload/task/BaseTask.ts","../src/upload/task/DirectTask.ts","../src/upload/task/ChunkTask.ts","../src/upload/UploaderBuilder.ts","../src/util/Debug.ts","../src/upload/hook/SimpleUploadListener.ts","../src/upload/pattren/DirectUploadPattern.ts","../src/upload/pattren/ChunkUploadPattern.ts","../src/upload/Uploader.ts"],"sourcesContent":["/**\n * 上传任务\n */\nabstract class BaseTask {\n    protected _file: File;\n    protected _retry: Number = 0;//已重试次数\n    protected _createDate: Date;//创建时间\n    protected _startDate: Date;//开始时间\n    protected _endDate: Date;//结束时间\n    protected _key: String;//key文件名\n    protected _progress: Number = 0;//任务进度,最大100\n    protected _isSuccess: Boolean = false;//是否上传成功\n    protected _isFinish: boolean = false;//是否结束\n    protected _result: Object;\n    protected _error: any;\n\n    constructor(file: File) {\n        this._file = file;\n        this._createDate = new Date();\n    }\n\n    get file(): File {\n        return this._file;\n    }\n\n    set file(value: File) {\n        this._file = value;\n    }\n\n    get retry(): Number {\n        return this._retry;\n    }\n\n    set retry(value: Number) {\n        this._retry = value;\n    }\n\n    get createDate(): Date {\n        return this._createDate;\n    }\n\n    set createDate(value: Date) {\n        this._createDate = value;\n    }\n\n    get startDate(): Date {\n        return this._startDate;\n    }\n\n    set startDate(value: Date) {\n        this._startDate = value;\n    }\n\n    get endDate(): Date {\n        return this._endDate;\n    }\n\n    set endDate(value: Date) {\n        this._endDate = value;\n    }\n\n    get isSuccess(): Boolean {\n        return this._isSuccess;\n    }\n\n    set isSuccess(value: Boolean) {\n        this._isSuccess = value;\n    }\n\n    get progress(): Number {\n        return this._progress;\n    }\n\n    set progress(value: Number) {\n        this._progress = Math.min(Math.max(0, value), 100);\n    }\n\n\n    get result() {\n        return this._result;\n    }\n\n    set result(value) {\n        this._result = value;\n    }\n\n    get error() {\n        return this._error;\n    }\n\n    set error(value) {\n        this._error = value;\n    }\n\n\n    get key(): String {\n        return this._key;\n    }\n\n    set key(value: String) {\n        this._key = value;\n    }\n\n    get isFinish(): boolean {\n        return this._isFinish;\n    }\n\n    set isFinish(value: boolean) {\n        this._isFinish = value;\n    }\n}\n\nexport default BaseTask;","import BaseTask from \"./BaseTask\";\n/**\n * 直传任务\n */\nclass DirectTask extends BaseTask {\n\n}\n\nexport default DirectTask;","import Task from \"./DirectTask\";\n/**\n * 分块任务\n */\nclass ChunkTask extends Task {\n    //分块\n    private _blocks: Block[] = [];\n\n    /**\n     * 构造函数\n     * @param file\n     * @param blockSize 块大小\n     * @param chunkSize 片大小\n     */\n    constructor(file: File, blockSize: number, chunkSize: number) {\n        super.constructor(file);\n        this.spliceFile2Block(blockSize, chunkSize);\n    }\n\n    /**\n     * 将文件分块\n     */\n    private spliceFile2Block(blockSize: number, chunkSize: number): void {\n        let fileSize: number = this.file.size;\n        let file: File = this.file;\n        //总块数\n        let blockCount = Math.ceil(fileSize / blockSize);\n\n        for (let i = 0; i < blockCount; i++) {\n            let start: number = i * blockSize;//起始位置\n            let end: number = start + blockSize;//结束位置\n            //构造一个块实例\n            let block: Block = new Block(start, end, file.slice(start, end), chunkSize);\n            //添加到数组中\n            this._blocks.push(block);\n        }\n    }\n\n    get blocks(): Block[] {\n        return this._blocks;\n    }\n\n    get totalChunkCount(): number {\n        let count = 0;\n        for (let block: Block of this._blocks) {\n            count += block.chunks.length;\n        }\n        return count;\n    }\n}\n\n/**\n * 分块，分块大小七牛固定是4M\n */\nclass Block {\n    private _data: Blob;//块数据\n    private _start: number;//起始位置\n    private _end: number;//结束为止\n    private _chunks: Chunk[] = [];\n\n    constructor(start: number, end: number, data: Blob, chunkSize: number) {\n        this._data = data;\n        this._start = start;\n        this._end = end;\n        this.spliceBlock2Chunk(chunkSize);\n    }\n\n    /**\n     * 将块分片\n     */\n    private spliceBlock2Chunk(chunkSize: number): void {\n        let blockSize: number = this._data.size;\n        let data: Blob = this._data;\n        //总片数\n        let chunkCount = Math.ceil(blockSize / chunkSize);\n        for (let i: number = 0; i < chunkCount; i++) {\n            let start: number = i * chunkSize;//起始位置\n            let end: number = start + chunkSize;//结束位置\n            //构造一个片实例\n            let chunk: Chunk = new Chunk(start, end, data.slice(start, end));\n            //添加到数组中\n            this._chunks.push(chunk);\n        }\n    }\n\n    get data(): Blob {\n        return this._data;\n    }\n\n    get start(): number {\n        return this._start;\n    }\n\n    get end(): number {\n        return this._end;\n    }\n\n    get chunks(): Chunk[] {\n        return this._chunks;\n    }\n}\n\n/**\n * 分片，分片大小可以自定义，至少1字节\n */\nclass Chunk {\n    private _start: number;//起始位置\n    private _end: number;//结束为止\n    private _data: Blob;//片数据\n    private _isFinish: boolean = false;//是否上传完成\n    private _ctx: string;//前一次上传返回的块级上传控制信息,第一个chunk此值为空\n\n    constructor(start: number, end: number, data: Blob) {\n        this._start = start;\n        this._end = end;\n        this._data = data;\n    }\n\n    get start(): number {\n        return this._start;\n    }\n\n    get end(): number {\n        return this._end;\n    }\n\n    get data(): Blob {\n        return this._data;\n    }\n\n    get isFinish(): boolean {\n        return this._isFinish;\n    }\n\n    set isFinish(value: boolean) {\n        this._isFinish = value;\n    }\n\n\n    get ctx(): string {\n        return this._ctx;\n    }\n\n    set ctx(value: string) {\n        this._ctx = value;\n    }\n}\n\n\nexport {ChunkTask, Block, Chunk};","import Uploader from \"./Uploader\";\nimport Interceptor from \"./interceptor/UploadInterceptor\";\nimport UploadListener from \"./hook/UploadListener\";\n\n/**\n * UploaderBuilder\n *\n */\nclass UploaderBuilder {\n    public static MAX_CHUNK_SIZE = 4 * 1024 * 1024;//分片最大值\n    public static BLOCK_SIZE = UploaderBuilder.MAX_CHUNK_SIZE;//分块大小，只有大于这个数才需要分块\n    public static UPLOAD_URL = 'http://upload.qiniu.com';\n\n    private _retry: number = 0;//最大重试次数\n    private _domain: string = UploaderBuilder.UPLOAD_URL;//上传域名\n    private _size: number = 1024 * 1024;//分片大小,单位字节,上限4m,不能为0\n    private _chunk: boolean = true;//分块上传\n    private _auto: boolean = true;//自动上传,每次选择文件后\n    private _multiple: boolean = true;//是否支持多文件\n    private _accept: string[] = [];//接受的文件类型\n    private _compress: number = 1;//图片压缩质量\n    private _scale: number[] = [0, 0];//缩放大小,限定高度等比[h:200,w:0],限定宽度等比[h:0,w:100],限定长宽[h:200,w:100]\n    private _listener: UploadListener;//监听器\n    private _tokenFunc: Function;//token获取函数\n    private _tokenShare: boolean = true;//分享token,如果为false,每一次HTTP请求都需要新获取Token\n    private _interceptors: Interceptor[] = [];//任务拦截器\n    private _isDebug: boolean = false;//\n\n\n    /**\n     * 设置上传的域名,默认是http://upload.qiniu.com/\n     * @param domain\n     * @returns {UploaderBuilder}\n     */\n    public domain(domain: string): UploaderBuilder {\n        this._domain = domain.endsWith('/') ? domain.substring(0, domain.length - 1) : domain;\n        return this;\n    }\n\n    /**\n     * 添加一个拦截器\n     * @param interceptor\n     * @returns {UploaderBuilder}\n     */\n    public interceptor(interceptor: Interceptor): UploaderBuilder {\n        this._interceptors.push(interceptor);\n        return this;\n    }\n\n    /**\n     * 上传失败后的重传尝试次数\n     * @param retry 默认0次，不尝试次重传\n     * @returns {UploaderBuilder}\n     */\n    public retry(retry: number): UploaderBuilder {\n        this._retry = retry;\n        return this;\n    }\n\n    /**\n     * 设置分片大小\n     * @param size 分块大小,单位字节,默认4*1024*1024字节(4mb)\n     * @returns {UploaderBuilder}\n     */\n    private size(size: number): UploaderBuilder {\n        this._size = Math.min(Math.max(size, 1), UploaderBuilder.MAX_CHUNK_SIZE);\n        return this;\n    }\n\n    /**\n     * 选择文件后,是否自动上传\n     * @param auto 默认true\n     * @returns {UploaderBuilder}\n     */\n    public auto(auto: boolean): UploaderBuilder {\n        this._auto = auto;\n        return this;\n    }\n\n    /**\n     * 是否支持多文件选择\n     * @param multiple 默认true\n     * @returns {UploaderBuilder}\n     */\n    public multiple(multiple: boolean): UploaderBuilder {\n        this._multiple = multiple;\n        return this;\n    }\n\n    /**\n     * 接受上传的文件类型\n     * @param accept 数组形式例如:['.png','video/*']\n     *\n     * 详细配置见http://www.w3schools.com/tags/att_input_accept.asp\n     *\n     * @returns {UploaderBuilder}\n     */\n    public accept(accept: string[]): UploaderBuilder {\n        this._accept = accept;\n        return this;\n    }\n\n    /**\n     * 图片质量压缩,只在上传的文件是图片的时候有效\n     * @param compress 0-1,默认1,不压缩\n     * @returns {UploaderBuilder}\n     */\n    public compress(compress: number): UploaderBuilder {\n        //0.95是最接近原图大小，如果质量为1的话会导致比原图大几倍。\n        this._compress = Math.max(Math.min(compress, 1), 0) * 0.95;\n        return this;\n    }\n\n    /**\n     * 图片缩放\n     * @returns {UploaderBuilder}\n     * @param scale\n     */\n    public scale(scale: number[]): UploaderBuilder {\n        this._scale = scale;\n        return this;\n    }\n\n    /**\n     * 获取Token的函数\n     * @param tokenFunc\n     * @returns {UploaderBuilder}\n     */\n    public tokenFunc(tokenFunc): UploaderBuilder {\n        this._tokenFunc = tokenFunc;\n        return this;\n    }\n\n    /**\n     * 上传生命周期钩子\n     * @param listener\n     * @returns {UploaderBuilder}\n     */\n    public listener(listener: UploadListener): UploaderBuilder {\n        this._listener = listener;\n        return this;\n    }\n\n    /**\n     * 是否分享token,如果为false每上传一个文件都需要请求一次Token。\n     * @param tokenShare\n     * @returns {UploaderBuilder}\n     */\n    public tokenShare(tokenShare: boolean): UploaderBuilder {\n        this._tokenShare = tokenShare;\n        return this;\n    }\n\n    /**\n     * 是否分块上传\n     * @param chunk 默认false\n     * @returns {UploaderBuilder}\n     */\n    public chunk(chunk: boolean): UploaderBuilder {\n        this._chunk = chunk;\n        return this;\n    }\n\n    /**\n     * 是否开启debug模式\n     * @param debug 默认false\n     * @returns {UploaderBuilder}\n     */\n    public debug(debug: boolean): UploaderBuilder {\n        this._isDebug = debug;\n        return this;\n    }\n\n    get getRetry(): number {\n        return this._retry;\n    }\n\n    get getSize(): number {\n        return this._size;\n    }\n\n    get getAuto(): boolean {\n        return this._auto;\n    }\n\n    get getMultiple(): boolean {\n        return this._multiple;\n    }\n\n    get getAccept(): string[] {\n        return this._accept;\n    }\n\n    get getCompress(): number {\n        return this._compress;\n    }\n\n    get getScale(): number[] {\n        return this._scale;\n    }\n\n    get getListener(): UploadListener {\n        return this._listener;\n    }\n\n    get getTokenFunc(): Function {\n        return this._tokenFunc;\n    }\n\n    get getTokenShare(): boolean {\n        return this._tokenShare;\n    }\n\n    get getChunk(): boolean {\n        return this._chunk;\n    }\n\n    get getIsDebug(): boolean {\n        return this._isDebug;\n    }\n\n    get getInterceptors(): Interceptor[] {\n        return this._interceptors;\n    }\n\n    get getDomain(): string {\n        return this._domain;\n    }\n\n    public build(): Uploader {\n        return new Uploader(this);\n    }\n}\n\nexport default UploaderBuilder;","class Debug {\n    private static _enable: boolean = true;\n\n    static get enable(): boolean {\n        return this._enable;\n    }\n\n    static set enable(value: boolean) {\n        this._enable = value;\n    }\n\n    public static d(object) {\n        if (!Debug._enable) {\n            return;\n        }\n        console.debug(object);\n    };\n\n    public static l(object) {\n        if (!Debug._enable) {\n            return;\n        }\n        console.log(object);\n    }\n\n    public static e(object) {\n        if (!Debug._enable) {\n            return;\n        }\n        console.error(object);\n    }\n\n    public static w(object) {\n        if (!Debug._enable) {\n            return;\n        }\n        console.warn(object);\n    }\n\n    public static i(object) {\n        if (!Debug._enable) {\n            return;\n        }\n        console.info(object);\n    }\n}\n\nexport default Debug;","import Task from \"../task/DirectTask\";\nimport UploadListener from \"./UploadListener\";\nclass SimpleUploadListener implements UploadListener {\n\n    onReady(taskQueue: Task[]): void {\n    }\n\n    onStart(taskQueue: Task[]): void {\n    }\n\n    onTaskProgress(task: Task): void {\n    }\n\n    onTaskGetKey(task: Task): string {\n        return null;\n    }\n\n    onTaskFail(task: Task): void {\n    }\n\n    onTaskSuccess(task: Task): void {\n    }\n\n    onTaskRetry(task: Task): void {\n    }\n\n    onFinish(taskQueue: Task[]): void {\n    }\n}\n\nexport  default SimpleUploadListener;","import IUploadPattern from \"./IUploadPattern\";\nimport Uploader from \"../Uploader\";\nimport DirectTask from \"../task/DirectTask\";\nimport debug from \"../../util/Debug\";\n/**\n * 直接上传\n */\nclass DirectUploadPattern implements IUploadPattern {\n    private uploader: Uploader;\n\n    init(uploader: Uploader): void {\n        this.uploader = uploader;\n    }\n\n    upload(task: DirectTask): void {\n        let xhr: XMLHttpRequest = new XMLHttpRequest();\n\n        //上传中\n        xhr.upload.onprogress = (e: ProgressEvent)=> {\n            if (e.lengthComputable) {\n                let progress = Math.round((e.loaded * 100) / e.total);\n                if (task.progress != progress) {\n                    task.progress = progress;\n                    this.uploader.listener.onTaskProgress(task);\n                }\n            }\n        };\n\n        //上传完成\n        xhr.upload.onload = ()=> {\n            if (task.progress != 100) {\n                task.progress = 100;\n                this.uploader.listener.onTaskProgress(task);\n            }\n        };\n\n\n        let url = this.uploader.domain;\n        url += ((/\\?/).test(this.uploader.domain) ? \"&\" : \"?\") + (new Date()).getTime();\n        xhr.open('POST', url, true);\n\n        xhr.onreadystatechange = ()=> {\n            if (xhr.readyState == XMLHttpRequest.DONE) {\n                if (xhr.status == 200 && xhr.responseText != '') {\n                    task.result = JSON.parse(xhr.responseText);\n                    task.isSuccess = true;\n                    task.isFinish = true;\n                    task.endDate = new Date();\n                    this.uploader.listener.onTaskSuccess(task);\n                }\n                else {\n                    if (this.retryTask(task)) {\n                        debug.w(`${task.file.name}上传失败,准备开始重传`);\n                        this.uploader.listener.onTaskRetry(task);\n                    }\n                    else {\n                        debug.w(`${task.file.name}上传失败`);\n                        try {\n                            task.error = JSON.parse(xhr.responseText);\n                        }\n                        catch (error: Error) {\n                            task.error = xhr.response;\n                        }\n                        task.isSuccess = false;\n                        task.isFinish = true;\n                        task.endDate = new Date();\n                        this.uploader.listener.onTaskFail(task);\n                    }\n                }\n\n                //所有任务都结束了\n                if (this.uploader.isTaskQueueFinish()) {\n                    //更改任务执行中标志\n                    this.uploader.tasking = false;\n\n                    //监听器调用\n                    this.uploader.listener.onFinish(this.uploader.taskQueue);\n                }\n            }\n        };\n\n        if (this.uploader.tokenShare && this.uploader.token) {\n            task.startDate = new Date();\n            let formData: FormData = DirectUploadPattern.createFormData(task, this.uploader.token);\n            xhr.send(formData);\n        }\n        else {\n            debug.d(`开始获取token`);\n            this.uploader.tokenFunc((token: string)=> {\n                debug.d(`token获取成功 ${token}`);\n                this.uploader.token = token;\n                task.startDate = new Date();\n                let formData: FormData = DirectUploadPattern.createFormData(task, this.uploader.token);\n                xhr.send(formData);\n            }, task);\n        }\n    }\n\n\n    private static createFormData(task: DirectTask, token: String): FormData {\n\n        let formData: FormData = new FormData();\n        if (task.key !== null && task.key !== undefined) {\n            formData.append('key', task.key);\n        }\n\n        formData.append('token', token);\n        formData.append('file', task.file);\n\n        debug.d(`创建formData对象`);\n\n        return formData;\n    }\n\n\n    private retryTask(task: DirectTask): boolean {\n        //达到重试次数\n        if (task.retry >= this.uploader.retry) {\n            debug.w(`${task.file.name}达到重传次数上限${this.uploader.retry},停止重传`);\n            return false;\n        }\n        task.retry++;\n        debug.w(`${task.file.name}开始重传,当前重传次数${task.retry}`);\n        this.upload(task);\n        return true;\n    }\n}\n\n\nexport  default DirectUploadPattern;","import IUploadPattern from \"./IUploadPattern\";\nimport Uploader from \"../Uploader\";\nimport {ChunkTask, Block, Chunk} from \"../task/ChunkTask\";\nimport debug from \"../../util/Debug\";\n\n/**\n * 分块上传\n */\nclass ChunkUploadPattern implements IUploadPattern {\n    private uploader: Uploader;\n\n    init(uploader: Uploader): void {\n        this.uploader = uploader;\n    }\n\n    /**\n     * 分块上传\n     */\n    upload(task: ChunkTask): void {\n        //只需要调用方法上传第一个块，之后就会递归调用自动上传。\n        let firstBlock: Block = task.blocks[0];\n        let firstChunk: Chunk = firstBlock.chunks[0];\n\n        if (this.uploader.tokenShare && this.uploader.token) {\n            task.startDate = new Date();\n            this.uploadChunk(firstChunk, firstBlock, task, this.uploader.token);\n        }\n        else {\n            debug.d(`开始获取token`);\n            this.uploader.tokenFunc((token: string)=> {\n                debug.d(`token获取成功 ${token}`);\n                this.uploader.token = token;\n                task.startDate = new Date();\n                this.uploadChunk(firstChunk, firstBlock, task, token);\n            }, task);\n        }\n    }\n\n    /**\n     *\n     * @param chunk 将要上传的chunk\n     * @param ctx 前一次上传返回的块级上传控制信息。\n     * @param nextHost 下一次的分片上传地址\n     * @param block 当前chunk属于的block\n     * @param task 分片任务\n     * @param token 上传凭证\n     */\n    private uploadChunk(chunk: Chunk, block: Block, task: ChunkTask, token: string, ctx?: string, nextHost?: string) {\n        let chunkIndex: number = block.chunks.indexOf(chunk);\n        let blockIndex: number = task.blocks.indexOf(block);\n        let prevBlocksSize: number = 0;\n        for (let i: number = 0; i < blockIndex; i++) {\n            prevBlocksSize += task.blocks[i].data.size;\n        }\n\n        let xhr: XMLHttpRequest = new XMLHttpRequest();\n        /**\n         * 根据index进行不同的上传策略，因为第一个chunk是随着创建block的时候附带上传的。\n         */\n\n            //根据index获取不同的上传url\n        let url: string = chunkIndex == 0 ? this.getUploadBlockUrl(block.data.size) : this.getUploadChunkUrl(chunk.start, ctx, nextHost);\n\n        xhr.open('POST', url += ((/\\?/).test(url) ? \"&\" : \"?\") + (new Date()).getTime(), true);\n        xhr.setRequestHeader('Content-Type', 'application/octet-stream');//设置contentType\n        xhr.setRequestHeader('Authorization', `UpToken ${token}`);//添加token验证头\n\n        //上传中\n        xhr.upload.onprogress = (e: ProgressEvent)=> {\n            if (e.lengthComputable) {\n                let progress = Math.round(((prevBlocksSize + chunk.start + e.loaded) / task.file.size) * 100);\n                if (task.progress != progress) {\n                    task.progress = progress;\n                    this.uploader.listener.onTaskProgress(task);\n                }\n            }\n        };\n\n        //上传完成\n        xhr.upload.onload = ()=> {\n            let progress = ((prevBlocksSize + chunk.start + chunk.data.size) / task.file.size) * 100;\n            if (task.progress != progress) {\n                task.progress = progress;\n                this.uploader.listener.onTaskProgress(task);\n            }\n        };\n\n        xhr.onreadystatechange = ()=> {\n            if (xhr.readyState == XMLHttpRequest.DONE) {\n                if (xhr.status == 200 && xhr.responseText != '') {\n                    let result: any = JSON.parse(xhr.responseText);\n                    chunk.isFinish = true;\n                    chunk.ctx = result.ctx;\n                    //判断是否还有chunk等待我们上传\n                    let hasNextChunk: boolean = block.chunks.indexOf(chunk) != block.chunks.length - 1;\n                    if (hasNextChunk) {\n                        let nextChunkIndex: number = chunkIndex + 1;\n                        let nextChunk: Chunk = block.chunks[nextChunkIndex];\n                        //上传下一个chunk\n                        this.uploadChunk(nextChunk, block, task, token, chunk.ctx, result.host);\n                    }\n                    else {\n                        //判断是否还有block等待我们上传\n                        let hasNextBlock: boolean = task.blocks.indexOf(block) != task.blocks.length - 1;\n                        if (hasNextBlock) {\n                            //上传下一个block\n                            let nextBlockIndex: number = blockIndex + 1;\n                            let nextBlock: Block = task.blocks[nextBlockIndex];\n                            this.uploadChunk(nextBlock.chunks[0], nextBlock, task, token);\n                        }\n                        //将之前上传的所有块组合成文件\n                        else {\n                            let encodedKey = task.key ? btoa(encodeURIComponent(task.key)) : null;\n                            let url = this.getMakeFileUrl(task.file.size, encodedKey);\n                            //构建所有数据块最后一个数据片上传后得到的<ctx>的组合成的列表字符串\n                            let ctxListString = '';\n\n                            for (let block: Block of task.blocks) {\n                                let lastChunk = block.chunks[block.chunks.length - 1];\n                                ctxListString += lastChunk.ctx + ',';\n                            }\n\n                            if (ctxListString.endsWith(',')) {\n                                ctxListString = ctxListString.substring(0, ctxListString.length - 1);\n                            }\n\n                            let xhr: XMLHttpRequest = new XMLHttpRequest();\n                            xhr.open('POST', url += ((/\\?/).test(url) ? \"&\" : \"?\") + (new Date()).getTime(), true);\n                            xhr.setRequestHeader('Content-Type', 'text/plain');//设置contentType\n                            xhr.setRequestHeader('Authorization', `UpToken ${token}`);//添加token验证头\n                            xhr.send(ctxListString);\n                            xhr.onreadystatechange = ()=> {\n                                if (xhr.readyState == XMLHttpRequest.DONE) {\n                                    task.isFinish = true;\n                                    if (xhr.status == 200 && xhr.responseText != '') {\n                                        let result: any = JSON.parse(xhr.responseText);\n                                        task.isSuccess = true;\n                                        task.endDate = new Date();\n                                        task.progress = 100;\n                                        this.uploader.listener.onTaskSuccess(task);\n                                    }\n                                    else {\n                                        if (this.retryTask(task)) {\n                                            debug.w(`${task.file.name}分块上传失败,准备开始重传`);\n                                            this.uploader.listener.onTaskRetry(task);\n                                        }\n                                        else {\n                                            debug.w(`${task.file.name}分块上传失败`);\n                                            task.error = JSON.parse(xhr.responseText);\n                                            task.error = task.error ? task.error : xhr.response;\n                                            task.isSuccess = false;\n                                            task.isFinish = true;\n                                            task.endDate = new Date();\n                                            this.uploader.listener.onTaskFail(task);\n                                        }\n                                    }\n\n                                    //所有任务都结束了\n                                    if (this.uploader.isTaskQueueFinish()) {\n                                        //更改任务执行中标志\n                                        this.uploader.tasking = false;\n\n                                        //监听器调用\n                                        this.uploader.listener.onFinish(this.uploader.taskQueue);\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n                else {\n                }\n            }\n        };\n        xhr.send(chunk.data);\n    }\n\n    private retryTask(task: ChunkTask): boolean {\n        //达到重试次数\n        if (task.retry >= this.uploader.retry) {\n            debug.w(`${task.file.name}达到重传次数上限${this.uploader.retry},停止重传`);\n            return false;\n        }\n        task.retry++;\n        debug.w(`${task.file.name}开始重传,当前重传次数${task.retry}`);\n        // this.upload(task);\n\n        //todo\n        return true;\n    }\n\n    /**\n     * 获取块上传的url\n     * @param blockSize\n     * @returns {string}\n     */\n    private  getUploadBlockUrl(blockSize: number): string {\n        return `${this.uploader.domain}/mkblk/${blockSize}`;\n    }\n\n    /**\n     * 获取片上传的url\n     * @param start 片的在块中的起始位置\n     * @param ctx 前一次上传返回的块级上传控制信息。\n     * @param host 指定host\n     */\n    private  getUploadChunkUrl(start: number, ctx: string, host?: string): string {\n        return `${host ? host : this.uploader.domain}/bput/${ctx}/${start}/`;\n    }\n\n    /**\n     * 获取合并块为文件的url\n     * @param fileSize 文件大小\n     * @param encodedKey base64UrlEncode后的资源名称,若未指定，则使用saveKey；若未指定saveKey，则使用资源内容的SHA1值作为资源名。\n     * @returns {string}\n     */\n    private  getMakeFileUrl(fileSize: number, encodedKey: string): string {\n        if (encodedKey) {\n            return `${this.uploader.domain}/mkfile/${fileSize}/key/${encodedKey}`;\n        }\n        else {\n            return `${this.uploader.domain}/mkfile/${fileSize}`;\n        }\n    }\n\n}\n\n\nexport  default ChunkUploadPattern;","import BaseTask from \"./task/BaseTask\";\nimport DirectTask from \"./task/DirectTask\";\nimport {ChunkTask} from \"./task/ChunkTask\";\nimport UploaderBuilder from \"./UploaderBuilder\";\nimport debug from \"../util/Debug\";\nimport Interceptor from \"./interceptor/UploadInterceptor\";\nimport UploadListener from \"./hook/UploadListener\";\nimport SimpleUploadListener from \"./hook/SimpleUploadListener\";\nimport DirectUploadPattern from \"./pattren/DirectUploadPattern\";\nimport ChunkUploadPattern from \"./pattren/ChunkUploadPattern\";\n\n\nclass Uploader {\n    private FILE_INPUT_EL_ID: string = 'qiniu4js-input';\n    private _fileInputId: string;\n    private _fileInput: HTMLInputElement;//input 元素\n    private _token: string;//token\n    private _taskQueue: BaseTask[] = [];//任务队列\n    private _tasking: boolean = false;//任务执行中\n    private _chunkUploadPattern: ChunkUploadPattern;\n    private _directUploadPattern: DirectUploadPattern;\n\n    private _retry: number;//最大重试次数\n    private _size: number;//分片大小,单位字节,最大4mb,不能为0\n    private _chunk: boolean;//分块上传,该选项开启后，只有在文件大于4mb的时候才会分块上传\n    private _auto: boolean;//自动上传,每次选择文件后\n    private _multiple: boolean;//是否支持多文件\n    private _accept: string[];//接受的文件类型\n    private _compress: number;//图片压缩质量\n    private _scale: number[] = [];//缩放大小,限定高度等比[h:200,w:0],限定宽度等比[h:0,w:100],限定长宽[h:200,w:100]\n    private _listener: UploadListener;//监听器\n    private _tokenFunc: Function;//token获取函数\n    private _tokenShare: boolean;//分享token,如果为false,每一次HTTP请求都需要新获取Token\n    private _interceptors: Interceptor[];//任务拦截器\n    private _domain: string;//上传域名\n\n    constructor(builder: UploaderBuilder) {\n        this._retry = builder.getRetry;\n        this._size = builder.getSize;\n        this._chunk = builder.getChunk;\n        this._auto = builder.getAuto;\n        this._multiple = builder.getMultiple;\n        this._accept = builder.getAccept;\n        this._compress = builder.getCompress;\n        this._scale = builder.getScale;\n        this._tokenFunc = builder.getTokenFunc;\n        this._tokenShare = builder.getTokenShare;\n        this._listener = Object.assign(new SimpleUploadListener(), builder.getListener);\n        this._interceptors = builder.getInterceptors;\n        this._domain = builder.getDomain;\n        this._fileInputId = `${this.FILE_INPUT_EL_ID}_${new Date().getTime()}`;\n        debug.enable = builder.getIsDebug;\n\n        this.validateOptions();\n\n        this.init();\n    }\n\n    /**\n     * 初始化操作\n     */\n    private init(): void {\n        this.initFileInputEl();\n        this.initUploadPattern();\n    }\n\n    /**\n     * 初始化上传模式\n     */\n    private initUploadPattern(): void {\n        this._directUploadPattern = new DirectUploadPattern();\n        this._directUploadPattern.init(this);\n\n        this._chunkUploadPattern = new ChunkUploadPattern();\n        this._chunkUploadPattern.init(this);\n    }\n\n    /**\n     * 初始化file input element\n     */\n    private initFileInputEl(): void {\n\n        //查询已经存在的file input\n        let exist: HTMLInputElement = document.getElementById(this._fileInputId);\n\n        //创建input元素\n        this._fileInput = exist ? exist : document.createElement('input');\n        this.fileInput.type = 'file';//type file\n        this.fileInput.id = this._fileInputId;//id 方便后面查找\n        this.fileInput.style.display = 'none';//隐藏file input\n\n        //多文件\n        if (this.multiple) {\n            //多文件\n            this.fileInput.multiple = true;\n        }\n\n        //文件类型\n        if (this.accept && this.accept.length != 0) {\n            let acceptValue: string = '';\n\n            for (let value: string of this.accept) {\n                acceptValue += value;\n                acceptValue += ',';\n            }\n\n            if (acceptValue.endsWith(',')) {\n                acceptValue = acceptValue.substring(0, acceptValue.length - 1);\n            }\n            this.fileInput.accept = acceptValue;\n            debug.d(`accept类型 ${acceptValue}`);\n        }\n\n        //将input元素添加到body子节点的末尾\n        document.body.appendChild(this.fileInput);\n\n        //选择文件监听器\n        this.fileInput.addEventListener('change', this.handleFiles, false);\n    }\n\n\n    /**\n     * 上传完成或者失败后,对本次上传任务进行清扫\n     */\n    private resetUploader(): void {\n        this.taskQueue.length = 0;\n        this._token = null;\n        debug.d(\"uploader已重置\");\n    }\n\n    /**\n     * 处理文件\n     */\n    private handleFiles = ()=> {\n        //如果没有选中文件就返回\n        if (this.fileInput.files.length == 0) {\n            return;\n        }\n\n        //生成task\n        this.generateTask();\n\n        //是否中断任务\n        let isInterrupt: Boolean = false;\n\n        //任务拦截器过滤\n        for (let task: BaseTask of this.taskQueue) {\n            for (let interceptor: Interceptor of this.interceptors) {\n                //拦截生效\n                if (interceptor.onIntercept(task)) {\n                    //从任务队列中去除任务\n                    this.taskQueue.splice(this.taskQueue.indexOf(task), 1);\n                    debug.d(\"任务拦截器拦截了任务:\");\n                    debug.d(task);\n                }\n                //打断生效\n                if (interceptor.onInterrupt(task)) {\n                    //将打断标志位设为true\n                    isInterrupt = true;\n                    break;\n                }\n            }\n        }\n\n        if (isInterrupt) {\n            debug.w(\"任务拦截器中断了任务队列\");\n            return;\n        }\n\n        //回调函数函数\n        this.listener.onReady(this.taskQueue);\n\n\n        //处理图片\n        this.handleImages().then((file)=> {\n            //自动上传\n            if (this.auto) {\n                debug.d(\"开始自动上传\");\n                this.start();\n            }\n        });\n    };\n\n\n    /**\n     * 生成task\n     */\n    private generateTask() {\n        this.resetUploader();\n\n        let files: FileList = this.fileInput.files;\n\n        //遍历files 创建上传任务\n        for (let i: number = 0; i < this.fileInput.files.length; i++) {\n            let file: File = files[i];\n\n            let task: BaseTask;\n            //只有在开启分块上传，并且文件大小大于4mb的时候才进行分块上传\n            if (this.chunk && file.size > UploaderBuilder.BLOCK_SIZE) {\n                task = new ChunkTask(file, UploaderBuilder.BLOCK_SIZE, this.size);\n            }\n            else {\n                task = new DirectTask(file);\n            }\n            task.key = this.listener.onTaskGetKey(task);\n            this.taskQueue.push(task);\n        }\n    }\n\n    /**\n     * 处理图片-缩放-质量压缩\n     */\n    private async handleImages(): Promise {\n        let promises: Promise[] = [];\n        for (let task: BaseTask of this.taskQueue) {\n            if (!task.file.type.match('image.*')) {\n                continue;\n            }\n            debug.d(`${task.file.name} 的大小:${task.file.size / 1024}kb`);\n\n            let canvas: HTMLCanvasElement = <HTMLCanvasElement> document.createElement('canvas');\n\n            let img: HTMLImageElement = new Image();\n            let ctx: CanvasRenderingContext2D = <CanvasRenderingContext2D>canvas.getContext('2d');\n            img.src = URL.createObjectURL(task.file);\n\n            let _this = this;\n            let promise: Promise = new Promise<Blob>((resolve) => {\n                img.onload = function () {\n\n                    let imgW = img.width;\n                    let imgH = img.height;\n\n                    let scaleW = _this.scale[0];\n                    let scaleH = _this.scale[1];\n\n                    if (scaleW <= 0 && scaleH > 0) {\n                        canvas.width = imgW / imgH * scaleH;\n                        canvas.height = scaleH;\n                    }\n                    else if (scaleH <= 0 && scaleW > 0) {\n                        canvas.width = scaleW;\n                        canvas.height = imgH / imgW * scaleW;\n                    }\n                    else if (scaleW > 0 && scaleH > 0) {\n                        canvas.width = scaleW;\n                        canvas.height = scaleH;\n                    }\n                    else {\n                        canvas.width = img.width;\n                        canvas.height = img.height;\n                    }\n\n                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n\n                    canvas.toBlob((blob: Blob)=> {\n                        resolve(blob);\n                        debug.d(`${task.file.name} 压缩后的大小:${blob.size / 1024}kb`)\n                    }, \"image/jpeg\", _this.compress);\n                }\n            }).then((blob: any)=> {\n                blob.name = task.file.name;\n                task.file = blob;\n            });\n            promises.push(promise);\n        }\n\n        return Promise.all(promises);\n    }\n\n    /**\n     * 检验选项合法性\n     */\n    private  validateOptions(): void {\n        if (!this.tokenFunc) {\n            throw new Error('你必须提供一个获取Token的回调函数');\n        }\n        if (!this.scale || !this.scale instanceof Array || this.scale.length != 2) {\n            throw new Error('scale必须是长度为2的number类型的数组,scale[0]为宽度，scale[1]为长度');\n        }\n    }\n\n    /**\n     * 开始上传\n     */\n    public start(): void {\n        if (this.fileInput.files.length == 0) {\n            throw new Error('没有选中的文件，无法start');\n        }\n\n        if (this.tasking) {\n            throw new Error('任务执行中，请不要重复start');\n        }\n\n        this.listener.onStart(this.taskQueue);\n\n        //遍历任务队列\n        for (let task: BaseTask of this.taskQueue) {\n            //根据任务的类型调用不同的上传模式进行上传\n            if (task.constructor.name === DirectTask.name && task instanceof DirectTask) {\n                //直传\n                this._directUploadPattern.upload(task);\n            }\n            else if (task.constructor.name === ChunkTask.name && task instanceof ChunkTask) {\n                //分块上传\n                this._chunkUploadPattern.upload(task);\n            }\n            else {\n                throw new Error('非法的task类型');\n            }\n        }\n    }\n\n    /**\n     * 所有任务是否完成\n     * @returns {boolean}\n     */\n    public isTaskQueueFinish() {\n        for (let task: BaseTask of this.taskQueue) {\n            if (!task.isFinish) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    /**\n     * 选择文件\n     */\n    public chooseFile() {\n        this.fileInput.click();\n    }\n\n    get retry(): number {\n        return this._retry;\n    }\n\n    get size(): number {\n        return this._size;\n    }\n\n    get auto(): boolean {\n        return this._auto;\n    }\n\n    get multiple(): boolean {\n        return this._multiple;\n    }\n\n    get accept(): string[] {\n        return this._accept;\n    }\n\n    get compress(): number {\n        return this._compress;\n    }\n\n    get scale(): number[] {\n        return this._scale;\n    }\n\n    get listener(): UploadListener {\n        return this._listener;\n    }\n\n    get fileInput(): HTMLInputElement {\n        return this._fileInput;\n    }\n\n    get tokenShare(): boolean {\n        return this._tokenShare;\n    }\n\n    get chunk(): boolean {\n        return this._chunk;\n    }\n\n    get tokenFunc(): Function {\n        return this._tokenFunc;\n    }\n\n    get token(): string {\n        return this._token;\n    }\n\n    set token(value: string) {\n        this._token = value;\n    }\n\n    get taskQueue(): BaseTask[] {\n        return this._taskQueue;\n    }\n\n\n    get tasking(): boolean {\n        return this._tasking;\n    }\n\n    set tasking(value: boolean) {\n        this._tasking = value;\n    }\n\n    get fileInputId(): string {\n        return this._fileInputId;\n    }\n\n    get interceptors(): Interceptor[] {\n        return this._interceptors;\n    }\n\n    get domain(): string {\n        return this._domain;\n    }\n}\n\nexport default Uploader;"],"names":["Task","debug"],"mappings":"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"}